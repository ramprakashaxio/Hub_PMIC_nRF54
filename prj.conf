# =============================================================================
# Zephyr Project Configuration for MAX77658 PMIC Driver
# Target: nRF5340 / nRF52840
# =============================================================================

# -----------------------------------------------------------------------------
# Clock Configuration
# -----------------------------------------------------------------------------
# Use internal 32.768 kHz RC oscillator (LFRC) instead of external crystal (LFXO)
# This frees P0.00 (XL1) and P0.01 (XL2) for GPIO use
CONFIG_CLOCK_CONTROL_NRF_K32SRC_RC=y
CONFIG_CLOCK_CONTROL_NRF_K32SRC_RC_CALIBRATION=y

# -----------------------------------------------------------------------------
# C++ Support (if needed for driver library)
# -----------------------------------------------------------------------------
CONFIG_CPP=y
CONFIG_STD_CPP17=y
CONFIG_REQUIRES_FULL_LIBCPP=y
CONFIG_NEWLIB_LIBC=y

# -----------------------------------------------------------------------------
# I2C Configuration
# -----------------------------------------------------------------------------
CONFIG_I2C=y

# -----------------------------------------------------------------------------
# SPI Configuration (for other peripherals like MAX30001G ECG/BioZ AFE)
# -----------------------------------------------------------------------------
CONFIG_SPI=y

# -----------------------------------------------------------------------------
# GPIO Configuration
# -----------------------------------------------------------------------------
CONFIG_GPIO=y

# -----------------------------------------------------------------------------
# Serial / UART Console Configuration
# -----------------------------------------------------------------------------
CONFIG_SERIAL=y
CONFIG_CONSOLE=y
CONFIG_UART_CONSOLE=y

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------
CONFIG_LOG=y
CONFIG_LOG_MODE_DEFERRED=y

# Enable Debug Logging for I2C Subsystem
CONFIG_I2C_LOG_LEVEL_DBG=y

CONFIG_CLOCK_CONTROL_LOG_LEVEL_WRN=y

# 2. Keep Sensor logs enabled so you can see the data
CONFIG_SENSOR_LOG_LEVEL_INF=y

# 3. Reduce Kernel noise
CONFIG_LOG_DEFAULT_LEVEL=3
CONFIG_KERNEL_LOG_LEVEL_WRN=y

# Increase log buffer size to catch the flood of messages
CONFIG_LOG_BUFFER_SIZE=16384
CONFIG_LOG_PROCESS_THREAD_STACK_SIZE=4096

# -----------------------------------------------------------------------------
# Sensor Configuration
# -----------------------------------------------------------------------------
CONFIG_SENSOR=y
CONFIG_LOG_BACKEND_UART=y
CONFIG_PRINTK=y

# Enable floating point support for printf/LOG_INF
CONFIG_CBPRINTF_FP_SUPPORT=y

# -----------------------------------------------------------------------------
# PMIC MAX77658 Configuration
# -----------------------------------------------------------------------------
CONFIG_PMIC_MAX77658=y
CONFIG_PMIC_MAX77658_LOG_LEVEL=3
CONFIG_PMIC_MAX77658_PM=y
CONFIG_PMIC_MAX77658_FG=y

# Fuel Gauge Battery Configuration
CONFIG_PMIC_MAX77658_FG_DESIGN_CAP=350
CONFIG_PMIC_MAX77658_FG_RSENSE=10

# -----------------------------------------------------------------------------
# Memory Configuration
# -----------------------------------------------------------------------------
# Heap for dynamic allocation
CONFIG_HEAP_MEM_POOL_SIZE=16384

# Main stack size (increase if needed)
CONFIG_MAIN_STACK_SIZE=4096

# -----------------------------------------------------------------------------
# Debug Configuration (optional - disable for production)
# -----------------------------------------------------------------------------
# CONFIG_DEBUG=y
# CONFIG_DEBUG_OPTIMIZATIONS=y
# CONFIG_DEBUG_THREAD_INFO=y

CONFIG_MAX32664C_USE_EXTENDED_REPORTS=y

# ========================================
# Bluetooth Configuration (nRF54L15 Fixed)
# ========================================
CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_DEVICE_NAME="Neso Monitor"
CONFIG_BT_MAX_CONN=1

# Use the Nordic SoftDevice Controller
CONFIG_BT_LL_SOFTDEVICE=y

# Increase L2CAP buffers (Host Layer) - This handles the large data packets
CONFIG_BT_BUF_ACL_RX_SIZE=251
CONFIG_BT_BUF_ACL_TX_SIZE=251
CONFIG_BT_L2CAP_TX_MTU=247

# Data Length Update (DLE) support is usually auto-enabled by SoftDevice
CONFIG_BT_DATA_LEN_UPDATE=y

# Disable features not needed right now to reduce complexity
CONFIG_BT_GATT_CLIENT=n
CONFIG_BT_SMP=n

# -----------------------------------------------------------------------------
# Non-Volatile Storage (NVS) Configuration
# -----------------------------------------------------------------------------
# Enable Flash and NVS for persistent data storage
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_NVS=y

# Settings subsystem for key-value storage
CONFIG_SETTINGS=y

# Allow writing to flash while running
CONFIG_MPU_ALLOW_FLASH_WRITE=y